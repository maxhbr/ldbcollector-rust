
<head>
  <style> body { margin: 0; } </style>
  <script src="https://unpkg.com/force-graph"></script>
</head>

<body>
  <div id="graph"></div>

  <script>

    const gData = 
{"nodes":[{"id":"id_NodeIndex(9687)","name":"GPL v2.0"},{"id":"id_NodeIndex(9147)","name":"StronglyProtective"},{"id":"id_NodeIndex(1012)","name":"gnu gpl v2"},{"id":"id_NodeIndex(9689)","name":"GNU General Public License version 2 or later"},{"id":"id_NodeIndex(10150)","name":"GNU GENERAL PUBLIC LICENSE, VERSION 2"},{"id":"id_NodeIndex(10183)","name":"GPL ver.2"},{"id":"id_NodeIndex(10162)","name":"GNU GPL License, Version 2.0"},{"id":"id_NodeIndex(443)","name":"GPL-2.0+"},{"id":"id_NodeIndex(10151)","name":"GNU General Public License (GPL),Version 2"},{"id":"id_NodeIndex(10166)","name":"GPL-v2"},{"id":"id_NodeIndex(20)","name":"$DATA:license_flag:is_deprecated"},{"id":"id_NodeIndex(3768)","name":"$NOTE"},{"id":"id_NodeIndex(3898)","name":"GNU General Public License 2.0 or later"},{"id":"id_NodeIndex(10169)","name":"GPL license, Version 2.0"},{"id":"id_NodeIndex(9690)","name":"GNU General Public License version 2 or later (GPL v2 or later)"},{"id":"id_NodeIndex(9688)","name":"GPL-2"},{"id":"id_NodeIndex(9685)","name":"GNU General Public License version 2 (GPL v2)"},{"id":"id_NodeIndex(9694)","name":"GPL v2.0 or later"},{"id":"id_NodeIndex(22)","name":"Copyleft"},{"id":"id_NodeIndex(9700)","name":"libGeoIPUpdate is GPLv2 or later"},{"id":"id_NodeIndex(10175)","name":"GNU General Public License, Versions 2"},{"id":"id_NodeIndex(21)","name":"$DATA:license_flag:is_gnu"},{"id":"id_NodeIndex(10955)","name":"$RULE"},{"id":"id_NodeIndex(10148)","name":"GNU GENERAL PUBLIC LICENSE (GPL Version 2, June 1991)"},{"id":"id_NodeIndex(3767)","name":"$DATA:license_text"},{"id":"id_NodeIndex(9019)","name":"$RULE"},{"id":"id_NodeIndex(10147)","name":"GNU GENERAL PUBLIC LICENSE Version 2"},{"id":"id_NodeIndex(10149)","name":"GNU GENERAL PUBLIC LICENSE V2"},{"id":"id_NodeIndex(446)","name":"GPL-2.0-or-later"},{"id":"id_NodeIndex(9692)","name":"GPL v2 or later"},{"id":"id_NodeIndex(10165)","name":"GPL, Version 2.0"},{"id":"id_NodeIndex(3896)","name":"gpl-2.0-plus"},{"id":"id_NodeIndex(3897)","name":"GPL 2.0 or later"},{"id":"id_NodeIndex(9370)","name":"$NOTE"},{"id":"id_NodeIndex(9697)","name":"GPL2+"},{"id":"id_NodeIndex(9)","name":"$DATA:license_flag:is_fsf_free_libre"},{"id":"id_NodeIndex(3899)","name":"$DATA:license_text"},{"id":"id_NodeIndex(9140)","name":"https://spdx.org/licenses/GPL-2.0-or-later.html"},{"id":"id_NodeIndex(1020)","name":"gpl"},{"id":"id_NodeIndex(10164)","name":"GPL 2 "},{"id":"id_NodeIndex(9403)","name":"Unknown (strong_copyleft)"},{"id":"id_NodeIndex(10171)","name":"GNU General Public License as published by the Free Software Foundation; version 2"},{"id":"id_NodeIndex(9699)","name":"GPLv2+"},{"id":"id_NodeIndex(444)","name":"GNU General Public License v2.0 or later"},{"id":"id_NodeIndex(9684)","name":"GNU General Public License (GPL) v2"},{"id":"id_NodeIndex(9371)","name":"$RULE"},{"id":"id_NodeIndex(10178)","name":"GNU General Public License (v2.0"},{"id":"id_NodeIndex(9143)","name":"GNU General Public License"},{"id":"id_NodeIndex(10177)","name":"GPL version 2"},{"id":"id_NodeIndex(9698)","name":"GPLv2 or later"},{"id":"id_NodeIndex(9139)","name":"https://spdx.org/licenses/GPL-2.0-only.html"},{"id":"id_NodeIndex(10155)","name":"GNU General Public License Version2"},{"id":"id_NodeIndex(1014)","name":"gpl v2"},{"id":"id_NodeIndex(3765)","name":"GPL 2.0"},{"id":"id_NodeIndex(9470)","name":"https://opensource.org/licenses/GPL-2.0"},{"id":"id_NodeIndex(10154)","name":"GNU General Public License V 2.0"},{"id":"id_NodeIndex(10158)","name":"GNU GPL v. 2"},{"id":"id_NodeIndex(10168)","name":"GPL V2 License"},{"id":"id_NodeIndex(9693)","name":"GPL v2+"},{"id":"id_NodeIndex(10179)","name":"GNU Public License (GPL) Version2"},{"id":"id_NodeIndex(10161)","name":"Gnu General Puplic License, Version 2.0"},{"id":"id_NodeIndex(1016)","name":"gpl2"},{"id":"id_NodeIndex(1018)","name":"gplv2"},{"id":"id_NodeIndex(3766)","name":"GNU General Public License 2.0"},{"id":"id_NodeIndex(9695)","name":"GPL-2+"},{"id":"id_NodeIndex(10173)","name":"The General Public License (GPL) Version 2"},{"id":"id_NodeIndex(10180)","name":"GNU General Public License, v.2"},{"id":"id_NodeIndex(3900)","name":"$NOTE"},{"id":"id_NodeIndex(10184)","name":"scancode:gpl-2.0"},{"id":"id_NodeIndex(10160)","name":"GNU Public License, Version 2"},{"id":"id_NodeIndex(10185)","name":"osi:GPL-2.0"},{"id":"id_NodeIndex(10174)","name":"under the terms of version 2 of the GNU Public License"},{"id":"id_NodeIndex(10508)","name":"Fedora Rating: [\"allowed\"]"},{"id":"id_NodeIndex(2)","name":"$DATA:license_flag:is_osi_approved"},{"id":"id_NodeIndex(10940)","name":"http://www.gnu.org/licenses/old-licenses/gpl-2.0.html"},{"id":"id_NodeIndex(10181)","name":"GNU General Public License (Version 2.0)"},{"id":"id_NodeIndex(10159)","name":"GNU Public License 2.0"},{"id":"id_NodeIndex(441)","name":"GPL-2.0"},{"id":"id_NodeIndex(10176)","name":"GNU Public License version 2"},{"id":"id_NodeIndex(10939)","name":"$RULE"},{"id":"id_NodeIndex(10172)","name":"GNU General Public License (GPL) version 2"},{"id":"id_NodeIndex(9696)","name":"GPL-2.0 or later"},{"id":"id_NodeIndex(9683)","name":"GLPv2"},{"id":"id_NodeIndex(10170)","name":"General Public License 2.0"},{"id":"id_NodeIndex(10163)","name":"GPLv2 "},{"id":"id_NodeIndex(10167)","name":"GPL License v.2"},{"id":"id_NodeIndex(10157)","name":"version 2 of the GNU General Public License"},{"id":"id_NodeIndex(9691)","name":"GNU General Public License version 2 or later (GPLv2 or later)"},{"id":"id_NodeIndex(442)","name":"GNU General Public License v2.0 only"},{"id":"id_NodeIndex(10152)","name":"GNU General Public License 2"},{"id":"id_NodeIndex(9020)","name":"$RULE"},{"id":"id_NodeIndex(10153)","name":"GNU General Public License License, Version 2"},{"id":"id_NodeIndex(10156)","name":"GNU General Public License, Version 2.0"},{"id":"id_NodeIndex(445)","name":"GPL-2.0-only"},{"id":"id_NodeIndex(9686)","name":"GPL v2 only"},{"id":"id_NodeIndex(10182)","name":"GNU General Public License as published by the Free Software Foundation; Version 2 (GPL)"}],"links":[{"source":"id_NodeIndex(442)","target":"id_NodeIndex(441)","name":"Same"},{"source":"id_NodeIndex(20)","target":"id_NodeIndex(442)","name":"AppliesTo"},{"source":"id_NodeIndex(9)","target":"id_NodeIndex(442)","name":"AppliesTo"},{"source":"id_NodeIndex(21)","target":"id_NodeIndex(442)","name":"AppliesTo"},{"source":"id_NodeIndex(2)","target":"id_NodeIndex(442)","name":"AppliesTo"},{"source":"id_NodeIndex(22)","target":"id_NodeIndex(442)","name":"AppliesTo"},{"source":"id_NodeIndex(444)","target":"id_NodeIndex(443)","name":"Same"},{"source":"id_NodeIndex(20)","target":"id_NodeIndex(444)","name":"AppliesTo"},{"source":"id_NodeIndex(9)","target":"id_NodeIndex(444)","name":"AppliesTo"},{"source":"id_NodeIndex(21)","target":"id_NodeIndex(444)","name":"AppliesTo"},{"source":"id_NodeIndex(2)","target":"id_NodeIndex(444)","name":"AppliesTo"},{"source":"id_NodeIndex(22)","target":"id_NodeIndex(444)","name":"AppliesTo"},{"source":"id_NodeIndex(442)","target":"id_NodeIndex(445)","name":"Same"},{"source":"id_NodeIndex(444)","target":"id_NodeIndex(446)","name":"Same"},{"source":"id_NodeIndex(1014)","target":"id_NodeIndex(441)","name":"HintsTowards"},{"source":"id_NodeIndex(441)","target":"id_NodeIndex(441)","name":"HintsTowards"},{"source":"id_NodeIndex(1016)","target":"id_NodeIndex(441)","name":"HintsTowards"},{"source":"id_NodeIndex(1018)","target":"id_NodeIndex(441)","name":"HintsTowards"},{"source":"id_NodeIndex(1020)","target":"id_NodeIndex(441)","name":"HintsTowards"},{"source":"id_NodeIndex(445)","target":"id_NodeIndex(441)","name":"Same"},{"source":"id_NodeIndex(3765)","target":"id_NodeIndex(441)","name":"Same"},{"source":"id_NodeIndex(3766)","target":"id_NodeIndex(441)","name":"Same"},{"source":"id_NodeIndex(441)","target":"id_NodeIndex(441)","name":"Same"},{"source":"id_NodeIndex(22)","target":"id_NodeIndex(441)","name":"AppliesTo"},{"source":"id_NodeIndex(3767)","target":"id_NodeIndex(441)","name":"AppliesTo"},{"source":"id_NodeIndex(2)","target":"id_NodeIndex(441)","name":"AppliesTo"},{"source":"id_NodeIndex(3768)","target":"id_NodeIndex(441)","name":"AppliesTo"},{"source":"id_NodeIndex(446)","target":"id_NodeIndex(3896)","name":"Same"},{"source":"id_NodeIndex(3897)","target":"id_NodeIndex(3896)","name":"Same"},{"source":"id_NodeIndex(3898)","target":"id_NodeIndex(3896)","name":"Same"},{"source":"id_NodeIndex(22)","target":"id_NodeIndex(3896)","name":"AppliesTo"},{"source":"id_NodeIndex(3899)","target":"id_NodeIndex(3896)","name":"AppliesTo"},{"source":"id_NodeIndex(3900)","target":"id_NodeIndex(3896)","name":"AppliesTo"},{"source":"id_NodeIndex(9019)","target":"id_NodeIndex(445)","name":"AppliesTo"},{"source":"id_NodeIndex(9020)","target":"id_NodeIndex(446)","name":"AppliesTo"},{"source":"id_NodeIndex(9139)","target":"id_NodeIndex(445)","name":"AppliesTo"},{"source":"id_NodeIndex(9140)","target":"id_NodeIndex(446)","name":"AppliesTo"},{"source":"id_NodeIndex(9143)","target":"id_NodeIndex(445)","name":"Better"},{"source":"id_NodeIndex(9143)","target":"id_NodeIndex(446)","name":"Better"},{"source":"id_NodeIndex(9147)","target":"id_NodeIndex(9143)","name":"AppliesTo"},{"source":"id_NodeIndex(22)","target":"id_NodeIndex(9147)","name":"AppliesTo"},{"source":"id_NodeIndex(3766)","target":"id_NodeIndex(445)","name":"Same"},{"source":"id_NodeIndex(3766)","target":"id_NodeIndex(446)","name":"Same"},{"source":"id_NodeIndex(9370)","target":"id_NodeIndex(445)","name":"AppliesTo"},{"source":"id_NodeIndex(9370)","target":"id_NodeIndex(446)","name":"AppliesTo"},{"source":"id_NodeIndex(9371)","target":"id_NodeIndex(445)","name":"AppliesTo"},{"source":"id_NodeIndex(9371)","target":"id_NodeIndex(446)","name":"AppliesTo"},{"source":"id_NodeIndex(9371)","target":"id_NodeIndex(9370)","name":"AppliesTo"},{"source":"id_NodeIndex(9147)","target":"id_NodeIndex(441)","name":"AppliesTo"},{"source":"id_NodeIndex(9147)","target":"id_NodeIndex(443)","name":"AppliesTo"},{"source":"id_NodeIndex(9403)","target":"id_NodeIndex(441)","name":"AppliesTo"},{"source":"id_NodeIndex(9403)","target":"id_NodeIndex(445)","name":"AppliesTo"},{"source":"id_NodeIndex(9403)","target":"id_NodeIndex(446)","name":"AppliesTo"},{"source":"id_NodeIndex(9470)","target":"id_NodeIndex(441)","name":"AppliesTo"},{"source":"id_NodeIndex(9470)","target":"id_NodeIndex(3766)","name":"AppliesTo"},{"source":"id_NodeIndex(9683)","target":"id_NodeIndex(445)","name":"HintsTowards"},{"source":"id_NodeIndex(1012)","target":"id_NodeIndex(445)","name":"HintsTowards"},{"source":"id_NodeIndex(9684)","target":"id_NodeIndex(445)","name":"HintsTowards"},{"source":"id_NodeIndex(9685)","target":"id_NodeIndex(445)","name":"HintsTowards"},{"source":"id_NodeIndex(3765)","target":"id_NodeIndex(445)","name":"HintsTowards"},{"source":"id_NodeIndex(1014)","target":"id_NodeIndex(445)","name":"HintsTowards"},{"source":"id_NodeIndex(9686)","target":"id_NodeIndex(445)","name":"HintsTowards"},{"source":"id_NodeIndex(9687)","target":"id_NodeIndex(445)","name":"HintsTowards"},{"source":"id_NodeIndex(9688)","target":"id_NodeIndex(445)","name":"HintsTowards"},{"source":"id_NodeIndex(441)","target":"id_NodeIndex(445)","name":"HintsTowards"},{"source":"id_NodeIndex(445)","target":"id_NodeIndex(445)","name":"HintsTowards"},{"source":"id_NodeIndex(1016)","target":"id_NodeIndex(445)","name":"HintsTowards"},{"source":"id_NodeIndex(1018)","target":"id_NodeIndex(445)","name":"HintsTowards"},{"source":"id_NodeIndex(9689)","target":"id_NodeIndex(446)","name":"HintsTowards"},{"source":"id_NodeIndex(9690)","target":"id_NodeIndex(446)","name":"HintsTowards"},{"source":"id_NodeIndex(9691)","target":"id_NodeIndex(446)","name":"HintsTowards"},{"source":"id_NodeIndex(9692)","target":"id_NodeIndex(446)","name":"HintsTowards"},{"source":"id_NodeIndex(9693)","target":"id_NodeIndex(446)","name":"HintsTowards"},{"source":"id_NodeIndex(9694)","target":"id_NodeIndex(446)","name":"HintsTowards"},{"source":"id_NodeIndex(9695)","target":"id_NodeIndex(446)","name":"HintsTowards"},{"source":"id_NodeIndex(9696)","target":"id_NodeIndex(446)","name":"HintsTowards"},{"source":"id_NodeIndex(443)","target":"id_NodeIndex(446)","name":"HintsTowards"},{"source":"id_NodeIndex(446)","target":"id_NodeIndex(446)","name":"HintsTowards"},{"source":"id_NodeIndex(9697)","target":"id_NodeIndex(446)","name":"HintsTowards"},{"source":"id_NodeIndex(9698)","target":"id_NodeIndex(446)","name":"HintsTowards"},{"source":"id_NodeIndex(9699)","target":"id_NodeIndex(446)","name":"HintsTowards"},{"source":"id_NodeIndex(9700)","target":"id_NodeIndex(446)","name":"HintsTowards"},{"source":"id_NodeIndex(441)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(445)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10147)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10148)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(3766)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10149)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10150)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(9684)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10151)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10152)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10153)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10154)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10155)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10156)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10157)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10158)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10159)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10160)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10161)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10162)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10163)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10164)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10165)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10166)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10167)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10168)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10169)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(1014)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10170)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(9688)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(1016)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10171)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10172)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10173)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10174)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10175)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10176)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10177)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10178)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10179)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10180)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10181)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10182)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10183)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10184)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(10185)","target":"id_NodeIndex(3766)","name":"Same"},{"source":"id_NodeIndex(442)","target":"id_NodeIndex(445)","name":"Better"},{"source":"id_NodeIndex(1018)","target":"id_NodeIndex(445)","name":"Better"},{"source":"id_NodeIndex(10939)","target":"id_NodeIndex(445)","name":"AppliesTo"},{"source":"id_NodeIndex(10508)","target":"id_NodeIndex(445)","name":"AppliesTo"},{"source":"id_NodeIndex(10940)","target":"id_NodeIndex(445)","name":"AppliesTo"},{"source":"id_NodeIndex(444)","target":"id_NodeIndex(446)","name":"Better"},{"source":"id_NodeIndex(9699)","target":"id_NodeIndex(446)","name":"Better"},{"source":"id_NodeIndex(10955)","target":"id_NodeIndex(446)","name":"AppliesTo"},{"source":"id_NodeIndex(10508)","target":"id_NodeIndex(446)","name":"AppliesTo"},{"source":"id_NodeIndex(10940)","target":"id_NodeIndex(446)","name":"AppliesTo"}]}
;

let selfLoopLinks = {};
let sameNodesLinks = {};
const curvatureMinMax = 0.2;

// 1. assign each link a nodePairId that combines their source and target independent of the links direction
// 2. group links together that share the same two nodes or are self-loops
gData.links.forEach(link => {
  link.nodePairId = link.source <= link.target ? (link.source + "_" + link.target) : (link.target + "_" + link.source);
  let map = link.source === link.target ? selfLoopLinks : sameNodesLinks;
  if (!map[link.nodePairId]) {
    map[link.nodePairId] = [];
  }
  map[link.nodePairId].push(link);
});

// Compute the curvature for self-loop links to avoid overlaps
Object.keys(selfLoopLinks).forEach(id => {
  let links = selfLoopLinks[id];
  let lastIndex = links.length - 1;
  links[lastIndex].curvature = 1;
  let delta = (1 - curvatureMinMax) / lastIndex;
  for (let i = 0; i < lastIndex; i++) {
    links[i].curvature = curvatureMinMax + i * delta;
  }
});

// Compute the curvature for links sharing the same two nodes to avoid overlaps
Object.keys(sameNodesLinks).filter(nodePairId => sameNodesLinks[nodePairId].length > 1).forEach(nodePairId => {
  let links = sameNodesLinks[nodePairId];
  let lastIndex = links.length - 1;
  let lastLink = links[lastIndex];
  lastLink.curvature = curvatureMinMax;
  let delta = 2 * curvatureMinMax / lastIndex;
  for (let i = 0; i < lastIndex; i++) {
    links[i].curvature = - curvatureMinMax + i * delta;
    if (lastLink.source !== links[i].source) {
      links[i].curvature *= -1; // flip it around, otherwise they overlap
    }
  }
});

const Graph = ForceGraph()
  (document.getElementById('graph'))
    .nodeAutoColorBy('type')
    .linkAutoColorBy('label')
    //.dagMode('lr').dagLevelDistance(300)
    //.d3Force('collide', d3.forceCollide(13)).d3AlphaDecay(0.02).d3VelocityDecay(0.3)
    .linkCurvature('curvature')
    .linkDirectionalArrowRelPos(1)
    .linkDirectionalArrowLength(6)
  .nodeCanvasObject((node, ctx, globalScale) => {
    const label = node.name;
    const fontSize = 12/globalScale;
    ctx.font = `${fontSize}px Sans-Serif`;
    const textWidth = ctx.measureText(label).width;
    const bckgDimensions = [textWidth, fontSize].map(n => n + fontSize * 0.2); // some padding

    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
    ctx.fillRect(node.x - bckgDimensions[0] / 2, node.y - bckgDimensions[1] / 2, ...bckgDimensions);

    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillStyle = node.color;
    ctx.fillText(label, node.x, node.y);

    node.__bckgDimensions = bckgDimensions; // to re-use in nodePointerAreaPaint
  })
  .nodePointerAreaPaint((node, color, ctx) => {
    ctx.fillStyle = color;
    const bckgDimensions = node.__bckgDimensions;
    bckgDimensions && ctx.fillRect(node.x - bckgDimensions[0] / 2, node.y - bckgDimensions[1] / 2, ...bckgDimensions);
  })
  .linkCanvasObjectMode(() => 'after')
  .linkCanvasObject((link, ctx) => {
    const MAX_FONT_SIZE = 4;
    const LABEL_NODE_MARGIN = Graph.nodeRelSize() * 1.5;

    const start = link.source;
    const end = link.target;

    // ignore unbound links
    if (typeof start !== 'object' || typeof end !== 'object') return;

    // calculate label positioning
    const textPos = Object.assign(...['x', 'y'].map(c => ({
      [c]: start[c] + (end[c] - start[c]) / 2 // calc middle point
    })));

    const relLink = { x: end.x - start.x, y: end.y - start.y };

    const maxTextLength = Math.sqrt(Math.pow(relLink.x, 2) + Math.pow(relLink.y, 2)) - LABEL_NODE_MARGIN * 2;

    let textAngle = Math.atan2(relLink.y, relLink.x);
    // maintain label vertical orientation for legibility
    if (textAngle > Math.PI / 2) textAngle = -(Math.PI - textAngle);
    if (textAngle < -Math.PI / 2) textAngle = -(-Math.PI - textAngle);

    const label = `${link.name}`;

    // estimate fontSize to fit in link length
    ctx.font = '1px Sans-Serif';
    const fontSize = Math.min(MAX_FONT_SIZE, maxTextLength / ctx.measureText(label).width);
    ctx.font = `${fontSize}px Sans-Serif`;
    const textWidth = ctx.measureText(label).width;
    const bckgDimensions = [textWidth, fontSize].map(n => n + fontSize * 0.2); // some padding

    // draw text label (with background rect)
    ctx.save();
    ctx.translate(textPos.x, textPos.y);
    ctx.rotate(textAngle);

    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
    ctx.fillRect(- bckgDimensions[0] / 2, - bckgDimensions[1] / 2, ...bckgDimensions);

    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillStyle = 'darkgrey';
    ctx.fillText(label, 0, 0);
    ctx.restore();
  })
    .graphData(gData);
  // Spread nodes a little wider
  Graph.d3Force('charge').strength(-120);

</script>
</body>
