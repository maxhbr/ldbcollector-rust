
<head>
  <style> body { margin: 0; } </style>
  <script src="https://unpkg.com/force-graph"></script>
</head>

<body>
  <div id="graph"></div>

  <script>

    const gData = 
{"nodes":[{"id":"id_NodeIndex(10445)","name":"Lesser General Public License version 3.0"},{"id":"id_NodeIndex(10429)","name":"GNU Lesser General Public License, Version 3.0"},{"id":"id_NodeIndex(538)","name":"LGPL-3.0-only"},{"id":"id_NodeIndex(10339)","name":"GNU Lesser General Public License 3.0 (or any later version)"},{"id":"id_NodeIndex(9092)","name":"WeaklyProtective"},{"id":"id_NodeIndex(10432)","name":"GNU Lesser General Public v3"},{"id":"id_NodeIndex(10437)","name":"GNU Library or Lesser General Public License (LGPL), Version 3"},{"id":"id_NodeIndex(10439)","name":"Lesser GNU, Version 3.0"},{"id":"id_NodeIndex(4924)","name":"GNU Lesser General Public License 3.0"},{"id":"id_NodeIndex(10460)","name":"https://www.gnu.org/licenses/lgpl-3.0.txt"},{"id":"id_NodeIndex(10422)","name":"GNU Lesser General Public License (GNU LGPL), Version 3"},{"id":"id_NodeIndex(10441)","name":"LGPL v3"},{"id":"id_NodeIndex(10446)","name":"LGPL Licence Version 3"},{"id":"id_NodeIndex(10458)","name":"The GNU Lesser General Public License, Versions 2.1 and 3"},{"id":"id_NodeIndex(9083)","name":"https://spdx.org/licenses/LGPL-3.0-or-later.html"},{"id":"id_NodeIndex(10424)","name":"GNU Lesser GPL, Version 3"},{"id":"id_NodeIndex(10508)","name":"Fedora Rating: [\"allowed\"]"},{"id":"id_NodeIndex(536)","name":"LGPL-3.0+"},{"id":"id_NodeIndex(1027)","name":"Unknown (Copyleft Limited)"},{"id":"id_NodeIndex(10412)","name":"GNU General Lesser Public License, Version 3.0"},{"id":"id_NodeIndex(4925)","name":"$DATA:license_text"},{"id":"id_NodeIndex(9082)","name":"https://spdx.org/licenses/LGPL-3.0-only.html"},{"id":"id_NodeIndex(10428)","name":"GNU Lesser General Public License 3"},{"id":"id_NodeIndex(10442)","name":"LGPL 3"},{"id":"id_NodeIndex(10461)","name":"scancode:lgpl-3.0"},{"id":"id_NodeIndex(4926)","name":"$NOTE"},{"id":"id_NodeIndex(4933)","name":"lgpl-3.0-plus"},{"id":"id_NodeIndex(10420)","name":"GNU LGPL license v3.0"},{"id":"id_NodeIndex(9746)","name":"LGPLv3"},{"id":"id_NodeIndex(9751)","name":"LGPLv3+"},{"id":"id_NodeIndex(10434)","name":"GNU LesserGPLv3"},{"id":"id_NodeIndex(10452)","name":"LGPL3"},{"id":"id_NodeIndex(9379)","name":"$RULE"},{"id":"id_NodeIndex(10425)","name":"GNU Lesser General Public License (LGPL) v3.0"},{"id":"id_NodeIndex(9)","name":"$DATA:license_flag:is_fsf_free_libre"},{"id":"id_NodeIndex(10411)","name":"GNU General Lesser Public License (LGPL) version 3.00"},{"id":"id_NodeIndex(10433)","name":"GNU Lesser Public License, Version 3"},{"id":"id_NodeIndex(537)","name":"GNU Lesser General Public License v3.0 or later"},{"id":"id_NodeIndex(9084)","name":"GNU Library General Public License"},{"id":"id_NodeIndex(10436)","name":"GNU Lessor/Library Public License, Version 3.0"},{"id":"id_NodeIndex(10440)","name":"Lesser GNU Public License, Version 3.0"},{"id":"id_NodeIndex(10450)","name":"LGPL license, Version 3.0"},{"id":"id_NodeIndex(11113)","name":"http://www.fsf.org/licensing/licenses/lgpl.html"},{"id":"id_NodeIndex(10417)","name":"GNU LESSER GENERAL PUBLIC LICENSE VERSION 3"},{"id":"id_NodeIndex(10438)","name":"GNU Library or Lesser General Public License v3"},{"id":"id_NodeIndex(9482)","name":"https://opensource.org/licenses/LGPL-3.0"},{"id":"id_NodeIndex(22)","name":"Copyleft"},{"id":"id_NodeIndex(9750)","name":"LGPL v3 or later"},{"id":"id_NodeIndex(10415)","name":"GNU LESSER GENERAL PUBLIC LICENSE - Version 3"},{"id":"id_NodeIndex(11112)","name":"$RULE"},{"id":"id_NodeIndex(10416)","name":"GNU LESSER GENERAL PUBLIC LICENSE V3"},{"id":"id_NodeIndex(10426)","name":"GNU Lesser General Public License (LGPL), v.3"},{"id":"id_NodeIndex(9745)","name":"GNU Lesser General Public License version 3 (LGPL v3)"},{"id":"id_NodeIndex(10455)","name":"http://www.gnu.org/licenses/lgpl-3.0.txt"},{"id":"id_NodeIndex(10410)","name":"GNU General Lesser Public License (LGPL) version 3.0"},{"id":"id_NodeIndex(9378)","name":"$NOTE"},{"id":"id_NodeIndex(9032)","name":"$RULE"},{"id":"id_NodeIndex(10430)","name":"GNU Lesser General Public License, v3"},{"id":"id_NodeIndex(20)","name":"$DATA:license_flag:is_deprecated"},{"id":"id_NodeIndex(10444)","name":"Lesser General Public License (LGPL), v 3.0"},{"id":"id_NodeIndex(10457)","name":"Lesser GPL 3.0"},{"id":"id_NodeIndex(10427)","name":"GNU Lesser General Public License - v 3"},{"id":"id_NodeIndex(9402)","name":"Unknown (weak_copyleft)"},{"id":"id_NodeIndex(10435)","name":"GNU Library or Lesser General Public License (LGPL) 3.0"},{"id":"id_NodeIndex(10421)","name":"GNU Lesser General Public Licence, Version 3"},{"id":"id_NodeIndex(10423)","name":"GNU LIBRARY GENERAL PUBLIC LICENSE, Version 3.0"},{"id":"id_NodeIndex(10448)","name":"LGPL V3 License"},{"id":"id_NodeIndex(10413)","name":"GNU LESSER GENERAL PUBLIC LICENSE (LGPL) Version 3.0"},{"id":"id_NodeIndex(21)","name":"$DATA:license_flag:is_gnu"},{"id":"id_NodeIndex(10462)","name":"osi:LGPL-3.0"},{"id":"id_NodeIndex(10443)","name":"Lesser General Public License (LGPL) version 3.0"},{"id":"id_NodeIndex(10451)","name":"LGPL v.3"},{"id":"id_NodeIndex(10456)","name":"FSF Lesser GNU Public License, Version 3"},{"id":"id_NodeIndex(10431)","name":"GNU Lesser General Public License3"},{"id":"id_NodeIndex(10419)","name":"GNU LGPL V3"},{"id":"id_NodeIndex(535)","name":"GNU Lesser General Public License v3.0 only"},{"id":"id_NodeIndex(10449)","name":"LGPL Version 3"},{"id":"id_NodeIndex(539)","name":"LGPL-3.0-or-later"},{"id":"id_NodeIndex(11122)","name":"$RULE"},{"id":"id_NodeIndex(10418)","name":"GNU LESSER GENERAL PUBLIC LICENSE, Version 3"},{"id":"id_NodeIndex(9033)","name":"$RULE"},{"id":"id_NodeIndex(534)","name":"LGPL-3.0"},{"id":"id_NodeIndex(10414)","name":"GNU LESSER GENERAL PUBLIC LICENSE (LGPL) version 3"},{"id":"id_NodeIndex(2)","name":"$DATA:license_flag:is_osi_approved"},{"id":"id_NodeIndex(10454)","name":"http://opensource.org/licenses/lgpl-3.0.html"},{"id":"id_NodeIndex(10459)","name":"LGPL-3"},{"id":"id_NodeIndex(4923)","name":"LGPL 3.0"},{"id":"id_NodeIndex(10447)","name":"LGPL License (Version 3.0)"},{"id":"id_NodeIndex(9744)","name":"GNU Lesser General Public License (LGPL), Version 3"},{"id":"id_NodeIndex(10453)","name":"LGPv3"}],"links":[{"source":"id_NodeIndex(535)","target":"id_NodeIndex(534)","name":"Same"},{"source":"id_NodeIndex(20)","target":"id_NodeIndex(535)","name":"AppliesTo"},{"source":"id_NodeIndex(9)","target":"id_NodeIndex(535)","name":"AppliesTo"},{"source":"id_NodeIndex(21)","target":"id_NodeIndex(535)","name":"AppliesTo"},{"source":"id_NodeIndex(2)","target":"id_NodeIndex(535)","name":"AppliesTo"},{"source":"id_NodeIndex(22)","target":"id_NodeIndex(535)","name":"AppliesTo"},{"source":"id_NodeIndex(537)","target":"id_NodeIndex(536)","name":"Same"},{"source":"id_NodeIndex(20)","target":"id_NodeIndex(537)","name":"AppliesTo"},{"source":"id_NodeIndex(9)","target":"id_NodeIndex(537)","name":"AppliesTo"},{"source":"id_NodeIndex(21)","target":"id_NodeIndex(537)","name":"AppliesTo"},{"source":"id_NodeIndex(2)","target":"id_NodeIndex(537)","name":"AppliesTo"},{"source":"id_NodeIndex(22)","target":"id_NodeIndex(537)","name":"AppliesTo"},{"source":"id_NodeIndex(535)","target":"id_NodeIndex(538)","name":"Same"},{"source":"id_NodeIndex(537)","target":"id_NodeIndex(539)","name":"Same"},{"source":"id_NodeIndex(538)","target":"id_NodeIndex(534)","name":"Same"},{"source":"id_NodeIndex(4923)","target":"id_NodeIndex(534)","name":"Same"},{"source":"id_NodeIndex(4924)","target":"id_NodeIndex(534)","name":"Same"},{"source":"id_NodeIndex(534)","target":"id_NodeIndex(534)","name":"Same"},{"source":"id_NodeIndex(1027)","target":"id_NodeIndex(534)","name":"AppliesTo"},{"source":"id_NodeIndex(4925)","target":"id_NodeIndex(534)","name":"AppliesTo"},{"source":"id_NodeIndex(2)","target":"id_NodeIndex(534)","name":"AppliesTo"},{"source":"id_NodeIndex(4926)","target":"id_NodeIndex(534)","name":"AppliesTo"},{"source":"id_NodeIndex(539)","target":"id_NodeIndex(4933)","name":"Same"},{"source":"id_NodeIndex(1027)","target":"id_NodeIndex(4933)","name":"AppliesTo"},{"source":"id_NodeIndex(4926)","target":"id_NodeIndex(4933)","name":"AppliesTo"},{"source":"id_NodeIndex(9032)","target":"id_NodeIndex(538)","name":"AppliesTo"},{"source":"id_NodeIndex(9033)","target":"id_NodeIndex(539)","name":"AppliesTo"},{"source":"id_NodeIndex(9082)","target":"id_NodeIndex(538)","name":"AppliesTo"},{"source":"id_NodeIndex(9083)","target":"id_NodeIndex(539)","name":"AppliesTo"},{"source":"id_NodeIndex(9084)","target":"id_NodeIndex(538)","name":"Better"},{"source":"id_NodeIndex(9084)","target":"id_NodeIndex(539)","name":"Better"},{"source":"id_NodeIndex(9092)","target":"id_NodeIndex(9084)","name":"AppliesTo"},{"source":"id_NodeIndex(22)","target":"id_NodeIndex(9092)","name":"AppliesTo"},{"source":"id_NodeIndex(4924)","target":"id_NodeIndex(538)","name":"Same"},{"source":"id_NodeIndex(4924)","target":"id_NodeIndex(539)","name":"Same"},{"source":"id_NodeIndex(9378)","target":"id_NodeIndex(538)","name":"AppliesTo"},{"source":"id_NodeIndex(9378)","target":"id_NodeIndex(539)","name":"AppliesTo"},{"source":"id_NodeIndex(9379)","target":"id_NodeIndex(538)","name":"AppliesTo"},{"source":"id_NodeIndex(9379)","target":"id_NodeIndex(539)","name":"AppliesTo"},{"source":"id_NodeIndex(9379)","target":"id_NodeIndex(9378)","name":"AppliesTo"},{"source":"id_NodeIndex(9092)","target":"id_NodeIndex(534)","name":"AppliesTo"},{"source":"id_NodeIndex(9092)","target":"id_NodeIndex(536)","name":"AppliesTo"},{"source":"id_NodeIndex(9402)","target":"id_NodeIndex(534)","name":"AppliesTo"},{"source":"id_NodeIndex(9402)","target":"id_NodeIndex(536)","name":"AppliesTo"},{"source":"id_NodeIndex(9402)","target":"id_NodeIndex(538)","name":"AppliesTo"},{"source":"id_NodeIndex(9402)","target":"id_NodeIndex(539)","name":"AppliesTo"},{"source":"id_NodeIndex(9482)","target":"id_NodeIndex(534)","name":"AppliesTo"},{"source":"id_NodeIndex(9482)","target":"id_NodeIndex(4924)","name":"AppliesTo"},{"source":"id_NodeIndex(9744)","target":"id_NodeIndex(538)","name":"HintsTowards"},{"source":"id_NodeIndex(9745)","target":"id_NodeIndex(538)","name":"HintsTowards"},{"source":"id_NodeIndex(534)","target":"id_NodeIndex(538)","name":"HintsTowards"},{"source":"id_NodeIndex(538)","target":"id_NodeIndex(538)","name":"HintsTowards"},{"source":"id_NodeIndex(9746)","target":"id_NodeIndex(538)","name":"HintsTowards"},{"source":"id_NodeIndex(9750)","target":"id_NodeIndex(539)","name":"HintsTowards"},{"source":"id_NodeIndex(536)","target":"id_NodeIndex(539)","name":"HintsTowards"},{"source":"id_NodeIndex(539)","target":"id_NodeIndex(539)","name":"HintsTowards"},{"source":"id_NodeIndex(9751)","target":"id_NodeIndex(539)","name":"HintsTowards"},{"source":"id_NodeIndex(536)","target":"id_NodeIndex(10339)","name":"Same"},{"source":"id_NodeIndex(539)","target":"id_NodeIndex(10339)","name":"Same"},{"source":"id_NodeIndex(537)","target":"id_NodeIndex(10339)","name":"Same"},{"source":"id_NodeIndex(9751)","target":"id_NodeIndex(10339)","name":"Same"},{"source":"id_NodeIndex(534)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(538)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10410)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10411)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10412)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10413)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10414)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10415)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(4924)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10416)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10417)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10418)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10419)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10420)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10421)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10422)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10423)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10424)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10425)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(9744)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10426)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10427)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10428)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10429)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10430)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10431)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10432)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10433)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10434)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10435)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10436)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10437)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10438)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10439)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10440)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10441)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(9746)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10442)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10443)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10444)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10445)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10446)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10447)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10448)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10449)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10450)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10451)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10452)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10453)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10454)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10455)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10456)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10457)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10458)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10459)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10460)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10461)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(10462)","target":"id_NodeIndex(4924)","name":"Same"},{"source":"id_NodeIndex(535)","target":"id_NodeIndex(538)","name":"Better"},{"source":"id_NodeIndex(9746)","target":"id_NodeIndex(538)","name":"Better"},{"source":"id_NodeIndex(11112)","target":"id_NodeIndex(538)","name":"AppliesTo"},{"source":"id_NodeIndex(10508)","target":"id_NodeIndex(538)","name":"AppliesTo"},{"source":"id_NodeIndex(11113)","target":"id_NodeIndex(538)","name":"AppliesTo"},{"source":"id_NodeIndex(537)","target":"id_NodeIndex(539)","name":"Better"},{"source":"id_NodeIndex(9751)","target":"id_NodeIndex(539)","name":"Better"},{"source":"id_NodeIndex(11122)","target":"id_NodeIndex(539)","name":"AppliesTo"},{"source":"id_NodeIndex(10508)","target":"id_NodeIndex(539)","name":"AppliesTo"},{"source":"id_NodeIndex(11113)","target":"id_NodeIndex(539)","name":"AppliesTo"}]}
;

let selfLoopLinks = {};
let sameNodesLinks = {};
const curvatureMinMax = 0.2;

// 1. assign each link a nodePairId that combines their source and target independent of the links direction
// 2. group links together that share the same two nodes or are self-loops
gData.links.forEach(link => {
  link.nodePairId = link.source <= link.target ? (link.source + "_" + link.target) : (link.target + "_" + link.source);
  let map = link.source === link.target ? selfLoopLinks : sameNodesLinks;
  if (!map[link.nodePairId]) {
    map[link.nodePairId] = [];
  }
  map[link.nodePairId].push(link);
});

// Compute the curvature for self-loop links to avoid overlaps
Object.keys(selfLoopLinks).forEach(id => {
  let links = selfLoopLinks[id];
  let lastIndex = links.length - 1;
  links[lastIndex].curvature = 1;
  let delta = (1 - curvatureMinMax) / lastIndex;
  for (let i = 0; i < lastIndex; i++) {
    links[i].curvature = curvatureMinMax + i * delta;
  }
});

// Compute the curvature for links sharing the same two nodes to avoid overlaps
Object.keys(sameNodesLinks).filter(nodePairId => sameNodesLinks[nodePairId].length > 1).forEach(nodePairId => {
  let links = sameNodesLinks[nodePairId];
  let lastIndex = links.length - 1;
  let lastLink = links[lastIndex];
  lastLink.curvature = curvatureMinMax;
  let delta = 2 * curvatureMinMax / lastIndex;
  for (let i = 0; i < lastIndex; i++) {
    links[i].curvature = - curvatureMinMax + i * delta;
    if (lastLink.source !== links[i].source) {
      links[i].curvature *= -1; // flip it around, otherwise they overlap
    }
  }
});

const Graph = ForceGraph()
  (document.getElementById('graph'))
    .nodeAutoColorBy('type')
    .linkAutoColorBy('label')
    //.dagMode('lr').dagLevelDistance(300)
    //.d3Force('collide', d3.forceCollide(13)).d3AlphaDecay(0.02).d3VelocityDecay(0.3)
    .linkCurvature('curvature')
    .linkDirectionalArrowRelPos(1)
    .linkDirectionalArrowLength(6)
  .nodeCanvasObject((node, ctx, globalScale) => {
    const label = node.name;
    const fontSize = 12/globalScale;
    ctx.font = `${fontSize}px Sans-Serif`;
    const textWidth = ctx.measureText(label).width;
    const bckgDimensions = [textWidth, fontSize].map(n => n + fontSize * 0.2); // some padding

    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
    ctx.fillRect(node.x - bckgDimensions[0] / 2, node.y - bckgDimensions[1] / 2, ...bckgDimensions);

    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillStyle = node.color;
    ctx.fillText(label, node.x, node.y);

    node.__bckgDimensions = bckgDimensions; // to re-use in nodePointerAreaPaint
  })
  .nodePointerAreaPaint((node, color, ctx) => {
    ctx.fillStyle = color;
    const bckgDimensions = node.__bckgDimensions;
    bckgDimensions && ctx.fillRect(node.x - bckgDimensions[0] / 2, node.y - bckgDimensions[1] / 2, ...bckgDimensions);
  })
  .linkCanvasObjectMode(() => 'after')
  .linkCanvasObject((link, ctx) => {
    const MAX_FONT_SIZE = 4;
    const LABEL_NODE_MARGIN = Graph.nodeRelSize() * 1.5;

    const start = link.source;
    const end = link.target;

    // ignore unbound links
    if (typeof start !== 'object' || typeof end !== 'object') return;

    // calculate label positioning
    const textPos = Object.assign(...['x', 'y'].map(c => ({
      [c]: start[c] + (end[c] - start[c]) / 2 // calc middle point
    })));

    const relLink = { x: end.x - start.x, y: end.y - start.y };

    const maxTextLength = Math.sqrt(Math.pow(relLink.x, 2) + Math.pow(relLink.y, 2)) - LABEL_NODE_MARGIN * 2;

    let textAngle = Math.atan2(relLink.y, relLink.x);
    // maintain label vertical orientation for legibility
    if (textAngle > Math.PI / 2) textAngle = -(Math.PI - textAngle);
    if (textAngle < -Math.PI / 2) textAngle = -(-Math.PI - textAngle);

    const label = `${link.name}`;

    // estimate fontSize to fit in link length
    ctx.font = '1px Sans-Serif';
    const fontSize = Math.min(MAX_FONT_SIZE, maxTextLength / ctx.measureText(label).width);
    ctx.font = `${fontSize}px Sans-Serif`;
    const textWidth = ctx.measureText(label).width;
    const bckgDimensions = [textWidth, fontSize].map(n => n + fontSize * 0.2); // some padding

    // draw text label (with background rect)
    ctx.save();
    ctx.translate(textPos.x, textPos.y);
    ctx.rotate(textAngle);

    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
    ctx.fillRect(- bckgDimensions[0] / 2, - bckgDimensions[1] / 2, ...bckgDimensions);

    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillStyle = 'darkgrey';
    ctx.fillText(label, 0, 0);
    ctx.restore();
  })
    .graphData(gData);
  // Spread nodes a little wider
  Graph.d3Force('charge').strength(-120);

</script>
</body>
